(()=>{"use strict";var t=()=>{};(()=>{const t=16/9,e=500,i=888.8888888888888,s="0",n="8";class h{constructor(){this.subscriptions=[],this.open=!0}emit(t={}){for(let e=0;e<this.subscriptions.length;e++)this.callFunction(this.subscriptions[e],t)}async callFunction(t,e){t(e)}pipe(...t){let e=this;for(const i of t){const t=new h;e.on((e=>i(e,t))),e=t}return e}unsub(t){this.subscriptions=this.subscriptions.filter((e=>e!==t))}on(t){this.subscriptions.push(t)}}class o{constructor(t,e=0,i=0,s=0,n=0){this.destroy=new h,this.eventEmitter=t,this.x=e,this.y=i,this.width=s,this.height=n,this.lastMousePosition=null,this.isMouseHover=!1,this.id=1e6*Math.random()}set eventEmitter(t){this._eventEmitter=t?t.pipe(function(t){let e=!1;const i=()=>{e=!0,t.unsub(i)};return t.on(i),(t,i)=>{e&&(i.subscriptions=[]),i.emit(t)}}(this.destroy)):t}get eventEmitter(){return this._eventEmitter}render(t){}listenerEvent(t,e){var i;this.eventEmitter.pipe((i=e=>e.event===t,(t,e)=>{i(t)&&e.emit(t)})).on((t=>{t&&this.validateEventPropagation(t.position,t.event)&&e(t)}))}validateEventPropagation(t,e){return"5"===e||e===n||"7"===e||"9"===e||(this.isPositionInside(this.lastMousePosition)&&!this.isPositionInside(t)&&this.eventEmitter.emit({event:n}),this.lastMousePosition=t,this.isMouseHover=this.isPositionInside(t))}isPositionInside(t){return t&&t.x>=this.x&&t.x<=this.x+this.width&&t.y>=this.y&&t.y<=this.y+this.height}}class a extends o{constructor(t,e){super(e),this.navigator=t,this.backgroundColor="#f00",this.elements=[]}render(t){this.cleanCanvas(t);for(let e of this.elements)e.render(t)}cleanCanvas(t){t.rect(0,0,this.width,this.height),t.fillStyle=this.backgroundColor,t.fill()}validateEventPropagation(t,e){const i=super.validateEventPropagation(t,e);if(i)for(const i of this.elements)if(i.validateEventPropagation(t,e))return!1;return i}}function r(t,e,i){const s=c(t,i);return{x:e.x+s.x,y:e.y-s.y}}function c(t,e){return{x:t.x*Math.cos(e)-t.y*Math.sin(e),y:t.x*Math.sin(e)+t.y*Math.cos(e)}}function l(t){return t*window.currentWidth/e}function p(t){return t*e/window.currentWidth}function x(t,e=0){return Math.floor(Math.random()*t)+e}function u(t,e){if(t.length<3||e.length<3)return!1;const i=[...y(t),...y(e)];for(const s of i){const i=d(t,s),n=d(e,s);if(!(i.min>n.min&&i.min<n.max||i.max>n.min&&i.max<n.max||n.min>i.min&&n.min<i.max||n.max>i.min&&n.max<i.max||i.min===n.min&&i.max===n.max))return!1}return!0}function y(t){if(t.length<=1)return[];const e=[];for(let i=1;i<t.length;i++)e.push({x:t[i].x-t[i-1].x,y:t[i-1].y-t[i].y});return e.push({x:t[0].x-t[t.length-1].x,y:t[t.length-1].y-t[0].y}),e}function d(t,e){let i=m(e,t[0]),s=i;for(let n=1;n<t.length;n++){const h=m(e,t[n]);i=Math.min(i,h),s=Math.max(s,h)}return{min:i,max:s}}function m(t,e){return(e.x*t.x+e.y*t.y)/(t.x*t.x+t.y*t.y)}class g extends o{constructor(t,e=0,i=0,s=0,n=0){super(t,e,i,s,n),this.backgroundColor="#00f",this.rotation=0,this.scaleShape=4,this.brakedShape=null}updateCoordinates(t,e){this.x=t||this.x,this.y=e||this.y}render(t){const e=this.getProjection();for(const i of e){const e=i.points;if(0!==e.length){t.beginPath(),t.moveTo(l(e[0].x),l(e[0].y));for(let i=1;i<e.length;i++)t.lineTo(l(e[i].x),l(e[i].y));t.closePath(),t.fillStyle=i.background,this.brakedShape||t.stroke(),t.fill()}}}animate(){this.moveBrakedPiece()}brakeShapes(){const t=this.shipShape().shapes;this.brakedShape={shapes:[]};for(const e of t)this.brakedShape={shapes:[...this.brakedShape.shapes,...this.brakeShape(e)]};for(const t of this.brakedShape.shapes){const e=this.shapeCenter(t.points),i=(Math.random()+.5)/Math.sqrt(Math.pow(e.x,2)+Math.pow(e.y,2));t.vector={x:e.x*i,y:e.y*i}}}brakeShape(t){if(0===t.points.length)return t.points;const{min:e,max:i}=this.coverBox(t.points),s=[];let n=Math.ceil((i.x-e.x)*(i.y-e.y)/2);n=Math.min(n,150);for(let h=0;h<n;h++){const n={x:(i.x-e.x)*Math.random()+e.x,y:(i.y-e.y)*Math.random()+e.y};s.push({points:new Array(3).fill(null).map((()=>({x:n.x+2.5*Math.random(),y:n.y+2.5*Math.random()}))),background:t.background})}return s}shapeCenter(t){const{min:e,max:i}=this.coverBox(t);return{x:(i.x+e.x)/2,y:(i.y+e.y)/2}}coverBox(t){const e={x:t[0].x,y:t[0].y},i={...e};for(let s=1;s<t.length;s++)e.x=Math.min(e.x,t[s].x),e.y=Math.min(e.y,t[s].y),i.x=Math.max(i.x,t[s].x),i.y=Math.max(i.y,t[s].y);return{min:e,max:i}}moveBrakedPiece(){if(this.brakedShape)for(const t of this.brakedShape.shapes)t.points=t.points.map((e=>({x:e.x+t.vector.x,y:e.y+t.vector.y}))),t.background=this.reduceOpacity(t.background,30)}reduceOpacity(t,e){let i=this.getOpacity(t);return i=Math.min(255,Math.max(i-e,0)),i=i.toString(16),`#${t.substr(1,6)}${(i.length<2?"0":"")+i}`}getOpacity(t){return t.length>7?parseInt(t.substr(7,2),16):255}getProjection(){const t=this.rotation+Math.PI/2,e=this.shipShape().shapes,i={x:this.x,y:this.y},s=[];for(const n of e){const e=n.points.map((t=>({x:t.x*this.scaleShape,y:t.y*this.scaleShape})));for(let s=0;s<e.length;s++)e[s]=r(e[s],i,t);s.push({...n,points:e})}return s}shipShape(){return{shapes:[]}}}const S=JSON.parse('{"shapes":[{"background":"#cccccc","points":[{"x":0.5,"y":-6.3},{"x":1.1,"y":-5.5},{"x":1.7,"y":-2},{"x":1.8,"y":-0.1},{"x":1.9,"y":3},{"x":1.4,"y":3.8},{"x":1.4,"y":5.3},{"x":0.4,"y":5.3},{"x":0.3,"y":3.8},{"x":-0.3,"y":3.8},{"x":-0.4,"y":5.3},{"x":-1.4,"y":5.3},{"x":-1.4,"y":3.8},{"x":-1.9,"y":3},{"x":-1.8,"y":-0.1},{"x":-1.7,"y":-2},{"x":-1.1,"y":-5.5},{"x":-0.5,"y":-6.3},{"x":0,"y":-6.5}]},{"background":"#808080","points":[{"x":-5.3,"y":3},{"x":-2.3,"y":3.9},{"x":-2.3,"y":0.7},{"x":-5.3,"y":1.6}]},{"background":"#808080","points":[{"x":5.3,"y":3},{"x":2.3,"y":3.9},{"x":2.3,"y":0.7},{"x":5.3,"y":1.6}]},{"background":"#cccccc","points":[{"x":2.4,"y":0.7},{"x":2.3,"y":4},{"x":1.4,"y":4.3},{"x":-1.4,"y":4.3},{"x":-2.3,"y":4},{"x":-2.4,"y":0.7},{"x":-1.8,"y":0.1},{"x":1.8,"y":0.1}]},{"background":"#b3b3b3","points":[{"x":-0.7,"y":-2.3},{"x":0.7,"y":-2.3},{"x":1.4,"y":-0.1},{"x":1,"y":1.5},{"x":-1,"y":1.5},{"x":-1.4,"y":-0.1}]},{"background":"#999999","points":[{"x":-0.7,"y":-2.3},{"x":-0.4,"y":1.5},{"x":0.5,"y":1.5},{"x":0.7,"y":-2.3}]},{"background":"none","points":[{"x":-1.2,"y":4.3},{"x":1.2,"y":4.3},{"x":1,"y":1.5},{"x":-1,"y":1.5}]}]}');class v extends g{constructor(t,e=0,i=0,s=0,n=0){super(t,e,i,s,n),this.rotation=Math.PI/2,this.scaleShape=4,this.shape=S,this.animateSmokeInterval=0,this.enableSmoke=!1,this.updateCoordinates()}updateCoordinates(t,e){this.x=t||this.x,this.y=e||this.y}animate(){super.animate(),this.animateSmoke()}animateSmoke(){if(!this.brakedShape&&this.enableSmoke){const t=this.shape.shapes.filter((t=>t.smoke&&this.getOpacity(t.background)>0)),e=40,i=1,s=1,n=.5,h=1,o=6;for(const e of t)e.points=e.points.map((t=>({x:t.x+e.vector.x,y:t.y+e.vector.y}))),e.background=this.reduceOpacity(e.background,8);if(this.animateSmokeInterval++,this.animateSmokeInterval>n){this.animateSmokeInterval=0;for(let n=Math.min(e-t.length,i);n>=0;n--){const e=c({x:-s,y:0},3*Math.PI/2),i=2*Math.PI/o;t.unshift({background:"#CCCCCC64",vector:{x:e.x,y:e.y},smoke:!0,points:new Array(o).fill(0).map(((t,e)=>c({x:h*Math.random()+.6,y:0},e*i)))})}}this.shape={shapes:[...t,...this.shape.shapes.filter((t=>!t.smoke))]}}}shipShape(){return this.brakedShape||this.shape}}const f="4",b="5",k="6",E="7";class M{constructor(){this.score=null,this.spaces=[],this.time=0,this.ship={x:250,y:0,rotation:Math.PI/2,expectedRotation:0,velocity:0,minVelocity:10,acceleration:20,deceleration:-1.5,status:["3"],component:void 0},this.enemies=[],this.objects=[],this.configs={maxDistanceForShip:100,startDistanceForShip:200,maxDistanceForMeteorite:250,startDistanceForMeteorite:150,shipVelocity:5,meteoriteBaseVelocity:1.5,meteoriteStartVelocity:.7}}destroy(){this.spaces.forEach((t=>t.destroy.emit())),this.enemies.forEach((t=>t.component.destroy.emit())),this.objects.forEach((t=>t.component.destroy.emit())),this.ship.component.destroy.emit()}play(){this.shipStatus()!==E&&(this.animateComponents(),this.isFinish()||this.shipStatus()===k?this.shipStatus()===k&&(this.time++,this.time>20&&(this.ship.status=[b])):(this.time++,this.moveShip(),this.updateComponents(),this.updateSpaces(),this.updateScore(),this.checkCollision(),this.updateGameDifficulty()))}updateGameDifficulty(){this.configs.maxDistanceForShip=this.calculateScaleValue(100,50),this.configs.startDistanceForShip=this.calculateScaleValue(200,100),this.configs.maxDistanceForMeteorite=this.calculateScaleValue(250,150),this.configs.startDistanceForMeteorite=this.calculateScaleValue(150,50),this.configs.shipVelocity=this.calculateScaleValue(5,7,1),this.configs.meteoriteBaseVelocity=this.calculateScaleValue(1.5,3,1),this.configs.meteoriteStartVelocity=this.calculateScaleValue(.7,2,1)}calculateScaleValue(t,e,i=-1){return t+Math.abs(t-e)*(s=500,n=this.getScore(),Math.min(n/s,1))*i;var s,n}animateComponents(){this.enemies.forEach((t=>t.component.animate())),this.objects.forEach((t=>t.component.animate())),this.ship.component.animate()}pause(){!this.isFinish()&&this.canPauseGame()&&this.ship.status.push(E)}unpause(){this.shipStatus()===E&&this.ship.status.pop()}updateSpaces(){this.spaces.forEach((t=>t.setShipPosition(this.ship.y)))}updateScore(){this.score.score=this.getScore()}getScore(){return Math.floor(this.ship.y/50)}checkCollision(){const t=this.ship.component.getProjection().filter((t=>!t.smoke));let e;for(const i of this.enemies){const s=i.component.getProjection().filter((t=>!t.smoke));this.checkCollisionInProjections(t,s)&&(this.ship.status=[k],e=i.component)}for(const i of this.objects){const s=i.component.getProjection();this.checkCollisionInProjections(t,s)&&(this.ship.status=[k],e=i.component)}this.shipStatus()===k&&(e.brakeShapes(),this.ship.component.brakeShapes(),this.time=0)}checkCollisionInProjections(t,e){for(const i of t)for(const t of e)if(u(i.points,t.points))return!0;return!1}createEnemy(t){const e=this.getRandomXPosition(),s=Math.PI/3*2*Math.random()+Math.PI/6+Math.PI;this.enemies.push({x:e,y:i+this.ship.y+100,rotation:s,expectedRotation:s,velocity:this.configs.shipVelocity,component:t})}createMeteorite(t){const e=this.getRandomXPosition();this.objects.push({x:e,expectedX:e,y:i+this.ship.y+100,velocity:this.configs.meteoriteBaseVelocity*Math.random()+this.configs.meteoriteStartVelocity,rotation:0,component:t})}removeObject(t){this.objects=this.objects.filter((e=>e.component.id!==t))}removeEnemy(t){this.enemies=this.enemies.filter((e=>e.component.id!==t))}updateComponents(){this.ship.component.updateCoordinates(this.ship.x),this.ship.component.rotation=this.ship.rotation,this.enemies.forEach((t=>{this.moveEnemy(t),t.component.updateCoordinates(t.x,i-(t.y-this.ship.y)),t.component.rotation=t.rotation})),this.objects.forEach((t=>{this.moveMeteorite(t),t.component.updateCoordinates(t.x,i-(t.y-this.ship.y)),t.expectedX===t.x&&(t.expectedX=this.getRandomXPosition())}))}moveEnemy(t){this.wallCollision(t),this.rotate(t);const e=c({x:t.velocity,y:0},t.rotation);t.x+=e.x,t.y+=e.y}moveMeteorite(t){const e=t.velocity;let i=t.x+(t.x>t.expectedX?-e:t.x<t.expectedX?e:0);(t.x>t.expectedX&&i<t.expectedX||t.x<t.expectedX&&i>t.expectedX)&&(i=t.expectedX),t.x=i}getRandomXPosition(){return x(e-O,O/2)}launchShip(t){this.time=0,this.ship.expectedRotation=t,this.ship.status=["0"]}moveShip(){if(this.isShipStopped())this.ship.component.enableSmoke=!1;else{this.wallCollision(this.ship)&&this.ship.status.push(f),this.ship.component.enableSmoke=!0,this.calculateVelocity(),this.rotateShip();const t=c({x:this.ship.velocity,y:0},this.ship.rotation);this.ship.x+=t.x,this.ship.y+=t.y}}rotateShip(){this.rotate(this.ship),this.ship.rotation===this.ship.expectedRotation&&this.shipStatus()===f&&this.ship.status.pop()}rotate(t,e=1){const i=1e3/30*Math.PI/400*e;t.rotation>t.expectedRotation?t.rotation=Math.max(t.rotation-i,t.expectedRotation):t.rotation=Math.min(t.rotation+i,t.expectedRotation)}calculateVelocity(){if(this.shipStatus()===f)return;let t=0;"0"===this.shipStatus()&&(t=this.ship.velocity+30*this.ship.acceleration/1e3,t>15&&(this.ship.status=["1"])),"1"===this.shipStatus()&&(t=this.ship.velocity+30*this.ship.deceleration/1e3,t=Math.max(t,this.ship.minVelocity)),this.ship.velocity=t}isShipStopped(){return"3"===this.shipStatus()}isFinish(){return this.shipStatus()===b}canPauseGame(){return this.notMathStatus([k,b,E])}isShipClickable(){return this.notMathStatus([f,b,k,E])}notMathStatus(t){return t.reduce(((t,e)=>t&&this.shipStatus()!==e),!0)}wallCollision(t){return(t.rotation===t.expectedRotation&&t.x<50||t.rotation===t.expectedRotation&&t.x>450)&&(t.expectedRotation=Math.PI-t.rotation,t.expectedRotation+=t.expectedRotation<0?2*Math.PI:0,!0)}shipStatus(){return this.ship.status[this.ship.status.length-1]}}class w extends o{constructor(t,e,i){super(t,e,i),this.score=0,this.textSize=30,this.backgroundColor="#000",this.textColor="#fff",this.lastTime=0}render(t){t.font=`${l(this.textSize)}px Arial`;const e=t.measureText(this.score+""),i=e.width,s=e.actualBoundingBoxAscent+e.actualBoundingBoxDescent;t.beginPath(),t.rect(l(this.x-i-10),l(this.y),l(i+10),l(s+10)),t.fillStyle=this.backgroundColor,t.fill(),t.beginPath(),t.font=`${l(this.textSize)}px Arial`,t.fillStyle=this.textColor,t.fillText(this.score+"",l(this.x-i-5),l(this.y+s+5))}}class P extends o{constructor(t,e,i,s,n){super(t,e,i,s),this.group=n,this.shipY=0}render(t){t.beginPath(),t.fillStyle="rgba(255,255,255,0.4)",t.arc(l(this.x),l(this.y+this.shipY-this.group*i),l(this.width),0,2*Math.PI),t.fill()}}class C extends o{constructor(t,e=0,i=0,s=0,n=0,h,o=1,a=""){super(t,e,i,s,n),this.backgroundColor=a,this.shipY=0,this.stars=[],this.groupCount=0,this.ratio=h,this.velocity=o,this.generateSpace(),this.generateSpace()}setShipPosition(t){this.shipY=t/this.velocity}render(t){this.backgroundColor&&(t.beginPath(),t.fillStyle=this.backgroundColor,t.rect(0,0,l(this.width),l(this.height)),t.fill());let e=!1;for(let i=0;i<this.stars.length;i++){let s=!1;this.stars[i].forEach((e=>{this.isVisibleStar(e)&&(e.shipY=this.shipY,e.render(t),s=!0)})),e|=!s&&0===i}e&&(this.stars.shift(),this.generateSpace())}generateSpace(){const t=[];for(let i=0;i<20;i++)t.push(new P(this.eventEmitter,x(e),x(this.height),this.ratio,this.groupCount));this.groupCount++,this.stars.push(t)}isVisibleStar(t){const e=t.y+this.shipY-t.group*i;return e>=0&&e<i}}const I=JSON.parse('{"shapes":[{"background":"#b3b3b3","points":[{"x":-2.7,"y":-0.4},{"x":-1.9,"y":0.9},{"x":-1.4,"y":2},{"x":0,"y":4.1},{"x":1.4,"y":2},{"x":1.9,"y":0.9},{"x":2.7,"y":-0.4}]},{"background":"#e6e6e6","points":[{"x":-4.3,"y":-1.6},{"x":0,"y":-3.4},{"x":4.3,"y":-1.6},{"x":4.3,"y":-0.8},{"x":2,"y":0.3},{"x":0,"y":0.8},{"x":-2,"y":0.3},{"x":-4.3,"y":-0.8}]},{"background":"#999999","points":[{"x":0,"y":8},{"x":0.2,"y":5.3},{"x":0.9,"y":3.4},{"x":1.1,"y":1.1},{"x":1.2,"y":-0.2},{"x":1.1,"y":-1.6},{"x":0.9,"y":-2.5},{"x":0.5,"y":-3.5},{"x":0,"y":-3.8},{"x":-0.5,"y":-3.5},{"x":-0.9,"y":-2.5},{"x":-1.1,"y":-1.6},{"x":-1.2,"y":-0.2},{"x":-1.1,"y":1.1},{"x":-0.9,"y":3.4},{"x":-0.2,"y":5.3}]},{"background":"#e6e6e6","points":[{"x":0,"y":2.9},{"x":0.4,"y":2.7},{"x":0.7,"y":2.3},{"x":0.9,"y":1.4},{"x":0.9,"y":0.8},{"x":0.6,"y":0.1},{"x":0.3,"y":-0.3},{"x":0,"y":-0.5},{"x":-0.3,"y":-0.3},{"x":-0.6,"y":0.1},{"x":-0.9,"y":0.8},{"x":-0.9,"y":1.4},{"x":-0.7,"y":2.3},{"x":-0.4,"y":2.7}]},{"background":"#999999","points":[{"x":4.9,"y":3.2},{"x":5.1,"y":0.7},{"x":5.5,"y":-0.3},{"x":5.7,"y":-1.3},{"x":5.7,"y":-2.3},{"x":5.5,"y":-3.4},{"x":5.2,"y":-4.1},{"x":4.9,"y":-4.4},{"x":4.5,"y":-4.1},{"x":4.3,"y":-3.4},{"x":4,"y":-2.3},{"x":4,"y":-1.3},{"x":4.2,"y":-0.3},{"x":4.6,"y":0.7}]},{"background":"#999999","points":[{"x":-4.9,"y":3.2},{"x":-4.6,"y":0.7},{"x":-4.2,"y":-0.3},{"x":-4,"y":-1.3},{"x":-4,"y":-2.3},{"x":-4.3,"y":-3.4},{"x":-4.5,"y":-4.1},{"x":-4.9,"y":-4.4},{"x":-5.2,"y":-4.1},{"x":-5.5,"y":-3.4},{"x":-5.7,"y":-2.3},{"x":-5.7,"y":-1.3},{"x":-5.5,"y":-0.3},{"x":-5.1,"y":0.7}]}]}'),G=JSON.parse('{"shapes":[{"background":"#ececec","points":[{"x":-1.5,"y":2.1},{"x":-0.8,"y":4.1},{"x":-0.4,"y":5.2},{"x":0,"y":7},{"x":0.4,"y":5.2},{"x":0.8,"y":4.1},{"x":1.5,"y":2.1}]},{"background":"#999999","points":[{"x":4.5,"y":-0.4},{"x":1.4,"y":2.6},{"x":1.4,"y":2.9},{"x":-1.4,"y":2.9},{"x":-1.4,"y":2.6},{"x":-4.5,"y":-0.4}]},{"background":"#e6e6e6","points":[{"x":-6.4,"y":1.4},{"x":-6.2,"y":0},{"x":-5.8,"y":-1.4},{"x":-4.9,"y":-3.1},{"x":-4.2,"y":-4.1},{"x":-3.2,"y":-5},{"x":-2.2,"y":-5.5},{"x":-1.1,"y":-5.9},{"x":0,"y":-6.1},{"x":1.1,"y":-5.9},{"x":2.2,"y":-5.5},{"x":3.2,"y":-5},{"x":4.2,"y":-4.1},{"x":4.9,"y":-3.1},{"x":5.8,"y":-1.4},{"x":6.2,"y":0},{"x":6.4,"y":1.4},{"x":3.8,"y":0.8},{"x":2.3,"y":0.3},{"x":0,"y":-0.1},{"x":-2.3,"y":0.3},{"x":-3.8,"y":0.8}]},{"background":"#999999","points":[{"x":-1.7,"y":-4.4},{"x":-0.7,"y":-4.6},{"x":0.7,"y":-4.6},{"x":1.7,"y":-4.4},{"x":2,"y":-3.3},{"x":2.5,"y":-2.4},{"x":1.1,"y":-2.6},{"x":-1.1,"y":-2.6},{"x":-2.5,"y":-2.4},{"x":-2,"y":-3.3}]},{"background":"#4d4d4d","points":[{"x":-0.2,"y":-1.3},{"x":0.2,"y":-1.3},{"x":0.3,"y":0.6},{"x":-0.3,"y":0.6}]},{"background":"#4d4d4d","points":[{"x":1.9,"y":-0.9},{"x":2.1,"y":-0.1},{"x":2.1,"y":0.8},{"x":2.5,"y":0.9},{"x":2.4,"y":0},{"x":2.1,"y":-0.9}]},{"background":"#4d4d4d","points":[{"x":4,"y":1.3},{"x":4.4,"y":1.4},{"x":4.4,"y":0.3},{"x":4.1,"y":-0.5},{"x":3.8,"y":-0.6},{"x":4.1,"y":0.4}]},{"background":"#4d4d4d","points":[{"x":5.8,"y":1.8},{"x":6.2,"y":1.9},{"x":6.2,"y":1},{"x":6,"y":0.1},{"x":5.7,"y":0},{"x":5.8,"y":0.9}]},{"background":"#4d4d4d","points":[{"x":-1.9,"y":-0.9},{"x":-2.1,"y":-0.1},{"x":-2.1,"y":0.8},{"x":-2.5,"y":0.9},{"x":-2.4,"y":0},{"x":-2.1,"y":-0.9}]},{"background":"#4d4d4d","points":[{"x":-4,"y":1.3},{"x":-4.4,"y":1.4},{"x":-4.4,"y":0.3},{"x":-4.1,"y":-0.5},{"x":-3.8,"y":-0.6},{"x":-4.1,"y":0.4}]},{"background":"#4d4d4d","points":[{"x":-5.8,"y":1.8},{"x":-6.2,"y":1.9},{"x":-6.2,"y":1},{"x":-6,"y":0.1},{"x":-5.7,"y":0},{"x":-5.8,"y":0.9}]}]}');class B extends g{constructor(t,e=0,i=0,s=0){super(t,e,i,s+=s/2*Math.random(),0),this.rotationAnimate=Math.PI/30*Math.random()*(x(2)?1:-1),this.expectedX=0,this.generateShape(),this.updateCoordinates()}shipShape(){return this.brakedShape||this.shape}generateShape(){let t=[];const e=2*Math.PI/6;for(let i=0;i<6;i++)t.push(c({x:this.width/2,y:0},e*i));for(let e=0;e<4;e++){const e=[t[0]];for(let i=1;i<t.length;i++)e.push(this.randomMiddlePoint(t[i-1],t[i])),e.push(t[i]);e.push(this.randomMiddlePoint(t[t.length-1],t[0])),t=e}this.shape={shapes:[{background:"#b3b3b3",points:t}]}}randomMiddlePoint(t,e){const i=(t.x+e.x)/2,s=(t.y+e.y)/2,n=c(function(t,e){return{x:e.x-t.x,y:e.y-t.y}}(t,e),Math.PI/2),h=x(3,-1)/7;return{x:i+n.x*h,y:s+n.y*h}}animate(){super.animate(),this.brakedShape||(this.rotation+=this.rotationAnimate)}}class A extends o{constructor(t,e,i,s,h,o){super(t,e,i,s,h),this.text=o,this.textSize=10,this.backgroundColor="#000",this.textColor="#fff",this.textColorHover="#9a9a9a",this.listenerEvent("3",(t=>{this.isPositionInside(t.position)&&(document.body.style.cursor="pointer")})),this.listenerEvent(n,(t=>{document.body.style.cursor="default"}))}render(t){t.beginPath(),t.rect(l(this.x),l(this.y),l(this.width),l(this.height)),t.fillStyle=this.backgroundColor,t.fill(),t.beginPath(),t.font=`${l(this.textSize)}px Arial`;const e=t.measureText(this.text),i=p(e.width),s=p(e.actualBoundingBoxAscent+e.actualBoundingBoxDescent);t.fillStyle=this.isMouseHover?this.textColorHover:this.textColor,t.text,t.fillText(this.text,l(this.x+this.width/2-i/2),l(this.y+this.height/2+s/2))}}class R extends o{constructor(t,e,i,s,n){super(t,e,i,s,n),this.backgroundColor="#fff",this.textSize=90,this.text2Size=30,this.text="RECORD",this.score=1e3;const h=15;this.createCredits(this.x+h,this.y,40,30),this.createPlayButton(this.x+(this.width-40-120-h)/2,this.y+this.height-30-h,40,30),this.createShareButton(this.x+(this.width-40-120-h)/2+40+h,this.y+this.height-30-h,120,30)}createPlayButton(t,e,i,s){this.buttonPlay=new A(this.eventEmitter,t,e,i,s,"PLAY")}createCredits(t,e,i,n){this.buttonCredits=new A(this.eventEmitter,t,e,i,n,"@ggjnez92"),this.buttonCredits.backgroundColor="#00000000",this.buttonCredits.textColor="#000",this.buttonCredits.textColorHover="#0048ff",this.buttonCredits.listenerEvent(s,(()=>window.open("https://twitter.com/ggjnez92","_blank").focus()))}createShareButton(t,e,i,n){this.buttonShareRecord=new A(this.eventEmitter,t,e,i,n,"SHARE ON TWITTER"),this.buttonShareRecord.listenerEvent(s,(()=>{const t=`https://twitter.com/intent/tweet?text=${`I%20just%20make%20a%20new%20record%20of%20${this.score}%20points%20in%20the%20%23azetz%20%23game%20developed%20for%20the%20%40js13kGames%20competition.%0A%0A%23js13k%20%23gamedev%0A%0AIf%20you%20want%20to%20check%20it%20out%2C%20here%20is%20the%20link%20to%20the%20%23github%20repository%0Ahttps%3A%2F%2Fgithub.com%2Finflagames%2Fazetz`}`;window.open(t,"_blank").focus()}))}render(t){t.beginPath(),t.rect(0,0,l(e),l(i)),t.fillStyle="rgba(0,0,0,0.82)",t.fill(),t.beginPath(),t.rect(l(this.x),l(this.y),l(this.width),l(this.height)),t.fillStyle=this.backgroundColor,t.fill(),this.buttonPlay.render(t),this.buttonCredits.render(t),this.buttonShareRecord.render(t),this.renderScore(t)}renderScore(t){t.beginPath(),t.font=`${l(this.textSize)}px Arial`;const e=t.measureText(this.score+""),i=p(e.width),s=p(e.actualBoundingBoxAscent+e.actualBoundingBoxDescent);t.fillStyle="#000",t.fillText(this.score+"",l(this.x+this.width/2-i/2),l(this.y+this.height/2+s/2)),t.beginPath(),t.font=`${l(this.text2Size)}px Arial`;const n=t.measureText(this.text),h=p(n.width),o=p(n.actualBoundingBoxAscent+n.actualBoundingBoxDescent);t.fillStyle="#000",t.fillText(this.text,l(this.x+this.width/2-h/2),l(this.y+this.height/2+s/2-s-o/2))}}const j="azetzv1_game_score";let F=null;class D{static getInstance(){return F||(F=new D),F}saveScore(t){localStorage.setItem(j,t+"")}getScore(){const t=localStorage.getItem(j);return t?+t:0}}const T={Android:function(){return navigator.userAgent.match(/Android/i)},BlackBerry:function(){return navigator.userAgent.match(/BlackBerry/i)},iOS:function(){return navigator.userAgent.match(/iPhone|iPad|iPod/i)},Opera:function(){return navigator.userAgent.match(/Opera Mini/i)},Windows:function(){return navigator.userAgent.match(/IEMobile/i)||navigator.userAgent.match(/WPDesktop/i)},any:function(){return T.Android()||T.BlackBerry()||T.iOS()||T.Opera()||T.Windows()}},V=T.any(),O=100;class z extends a{constructor(t,e){super(t,e),this.spaces=[],this.buttonPause=new A(this.eventEmitter,10,10,60,30,"PAUSE"),this.buttonPause.textSize=20,this.buttonPause.listenerEvent(s,(()=>{this.currentGame.canPauseGame()&&(this.currentGame.pause(),this.showModal(D.getInstance().getScore(),!1))})),this.listenerEvent("1",this.shipClickDown.bind(this)),this.listenerEvent("4",this.shipClickDown.bind(this)),this.listenerEvent("2",this.shipClickUp.bind(this)),this.listenerEvent("3",this.shipClickMove.bind(this)),this.listenerEvent("5",this.shipClickUp.bind(this)),this.listenerEvent("6",this.shipClickMove.bind(this)),this.initGame()}initGame(){this.createNextObject=0,this.createNextShip=0,this.isModalShow=!1,this.currentGame&&this.currentGame.destroy(),this.currentGame=new M,this.spaces.push(new C(this.eventEmitter,0,0,e,i,3,1.1,"rgba(0,0,0,1)")),this.spaces.push(new C(this.eventEmitter,0,0,e,i,2,1.2)),this.spaces.push(new C(this.eventEmitter,0,0,e,i,1,1.5)),this.currentGame.spaces=this.spaces,this.ship=new v(this.eventEmitter,250,i-O,30,35),this.currentGame.ship.component=this.ship;const t=new w(this.eventEmitter,490,10);this.currentGame.score=t,this.elements=[this.ship,this.buttonPause],this.elements.push(t),this.playableElements=[this.ship]}shipClickUp(){this.shipPressed&&(this.shipPressed=!1,this.currentGame.launchShip(this.calculateShipRotation(this.directionToFlight)),V&&(this.directionToFlight=null))}shipClickDown(){this.currentGame.isShipClickable()&&(this.shipPressed=!0)}shipClickMove(t){this.directionToFlight=t.position}render(t){this.time||(this.time=0),this.time++,this.time>100&&(this.time=0,console.log("this.playableElements.length",this.playableElements.length),console.log("this.currentGame.ship.length",this.currentGame.enemies.length),console.log("this.currentGame.objects.length",this.currentGame.objects.length)),this.currentGame.play(),this.preShakeScreen(t),this.currentGame.isFinish()&&this.showModal(this.currentGame.getScore()),this.cleanCanvas(t),this.currentGame.isShipStopped()&&(this.ship.rotation=this.calculateShipRotation(this.directionToFlight)),this.renderOrRemovePlayableElements(t);for(const e of this.elements)e.render(t);this.createEnemyByTime(),this.posShakeScreen(t)}preShakeScreen(t){if(this.currentGame.shipStatus()===k){const e=10;if(this.currentGame.time>e)return;t.save();const i=x(20,-10),s=x(20,-10);t.translate(i,s)}}posShakeScreen(t){this.currentGame.shipStatus()===k&&t.restore()}showModal(t,e=!0){if(!this.isModalShow){this.isModalShow=!0;const s=300,n=200,h=new R(this.eventEmitter,250-s/2,i/2-s/2,s,n);D.getInstance().saveScore(Math.max(D.getInstance().getScore(),t)),h.score=t,h.buttonPlay.listenerEvent("2",(()=>{h.buttonPlay.destroy.emit(),h.buttonShareRecord.destroy.emit(),h.buttonCredits.destroy.emit(),this.currentGame.unpause(),this.elements.pop(),this.isModalShow=!1,e&&this.initGame()})),this.elements.push(h)}}createEnemyByTime(){this.createNextObject<this.currentGame.ship.y&&(this.createNextObject=this.currentGame.ship.y+x(this.currentGame.configs.maxDistanceForMeteorite,this.currentGame.configs.startDistanceForMeteorite),this.createMeteorite()),this.createNextShip<this.currentGame.ship.y&&(this.createNextShip=this.currentGame.ship.y+x(this.currentGame.configs.maxDistanceForShip,this.currentGame.configs.startDistanceForShip),this.createEnemy())}createEnemy(){const t=new v(this.eventEmitter,0,-i,30,35);t.shape=x(2)?I:G,t.enableSmoke=!0,this.playableElements.push(t),this.currentGame.createEnemy(t)}createMeteorite(){const t=new B(this.eventEmitter,0,-i,11);this.playableElements.push(t),this.currentGame.createMeteorite(t)}renderOrRemovePlayableElements(t){const e=new Set;for(const i of this.playableElements)this.isElementVisible(i)?i.render(t):(e.add(i.id),this.currentGame.removeEnemy(i.id),this.currentGame.removeObject(i.id));this.playableElements=this.playableElements.filter((t=>!e.has(t.id)))}isElementVisible(t){return t.y-2*t.height<i}calculateShipRotation(t){if(t){const e=Math.PI/6,s=Math.atan2(i-O-t.y,t.x-this.ship.x);return s>=0?Math.min(Math.PI-e,Math.max(e,s)):-s<Math.PI/2?e:Math.PI-e}return Math.PI/2}cleanCanvas(t){this.spaces.forEach((e=>e.render(t)))}}class X{constructor(t,i){this.gameWidth=e,this.gameHeght=888.8888888888888,this.sceneClasses=new Map,this.sceneClasses.set(1,z),this.scenesInstances=new Map,this.currentScene=null,i.on((t=>{this.currentScene.eventEmitter.emit(t),"8"===t.event&&t.dimension&&(this.gameWidth=t.dimension.w,this.gameHeght=t.dimension.h,this.updateGameDimensions())})),this.navigate(t)}navigate(t){this.scenesInstances.has(t)?this.currentScene=this.scenesInstances.get(t):this.sceneClasses.has(t)&&(this.scenesInstances.set(t,new(this.sceneClasses.get(t))(this,new h)),this.currentScene=this.scenesInstances.get(t)),this.updateGameDimensions()}updateGameDimensions(){this.currentScene&&(this.currentScene.width=this.gameWidth,this.currentScene.height=this.gameHeght)}}let L=null;class H{constructor(){window.addEventListener("resize",this.resizeScreen.bind(this)),this.canvas=document.getElementById("game"),this.registerEvents(),this.eventEmitter=new h,this.context=this.canvas.getContext("2d"),this.navigatorRoot=new X(1,this.eventEmitter),this.loopStatus=3,this.lastTime=0,this.width=this.canvas.width,this.height=this.canvas.height,this.resizeScreen()}registerEvents(){this.canvas.addEventListener("click",(t=>this.clickEvent(t,s))),this.canvas.addEventListener("mousedown",(t=>this.clickEvent(t,"1"))),this.canvas.addEventListener("mouseup",(t=>this.clickEvent(t,"2"))),this.canvas.addEventListener("mouseout",(t=>this.clickEvent(t,n))),this.canvas.addEventListener("mouseleave",(t=>this.clickEvent(t,"9"))),this.canvas.addEventListener("mousemove",(t=>this.clickEvent(t,"3"))),this.canvas.addEventListener("touchstart",(t=>this.touchEvent(t,"4")),!1),this.canvas.addEventListener("touchend",(t=>this.touchEvent(t,"5")),!1),this.canvas.addEventListener("touchcancel",(t=>this.touchEvent(t,"7")),!1),this.canvas.addEventListener("touchmove",(t=>this.touchEvent(t,"6")),!1)}resizeScreen(){const i=window.innerWidth,s=window.innerHeight;let n=Math.min(e,i),h=n*t;h>s&&(h=s,n=s/t),this.canvas.width=n,this.canvas.height=h,window.currentWidth=n,this.eventEmitter.emit({event:"8",dimension:{w:n,h}})}touchEvent(t,e){this.emitPositionEvent({x:t?.targetTouches[0]?.pageX,y:t?.targetTouches[0]?.pageY},e)}clickEvent(t,e){this.emitPositionEvent({x:t?.clientX,y:t?.clientY},e)}emitPositionEvent(t,e){const i=this.canvas.getBoundingClientRect();this.eventEmitter.emit({event:e,position:{x:p(t.x-i.left),y:p(t.y-i.top)}})}static getInstance(){return L||(L=new H),L}init(){this.loopStatus=1,requestAnimationFrame(this.loop.bind(this))}loop(t){1===this.loopStatus&&(this.currentTime=t,1===this.loopStatus&&33.333333333333336<=t-this.lastTime&&(this.lastTime=t,this.drawScreen()),requestAnimationFrame(this.loop.bind(this)))}drawScreen(){this.navigatorRoot.currentScene.render(this.context)}}H.getInstance().init()})(),t()})();
//# sourceMappingURL=main.js.map